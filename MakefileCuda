CXX = nvcc
CXXFLAGS = -Wno-deprecated-gpu-targets -arch=sm_75 --compiler-options '-Wall -Wextra -Werror -fopenmp -march=native'

CXXOPT = -O3
INCLUDE = -I./srcCuda
CXXCMD = $(CXX) $(CXXFLAGS) $(CXXOPT) $(INCLUDE)

headers = $(wildcard ./srcCuda/*.hpp)
cpp_sources = $(wildcard ./srcCuda/*.cpp)
cu_sources = $(wildcard ./srcCuda/*.cu)
sources = $(cpp_sources) $(cu_sources)
objects = $(sources:%.cpp=%.o)
objects := $(objects:%.cu=%.o)

mains = graphics/burned_probabilities_data graphics/fire_animation_data

all: $(mains)

%.o: %.cpp $(headers)
	$(CXXCMD) -c $< -o $@

%.o: %.cu $(headers)
	$(CXXCMD) -c $< -o $@

$(mains): %: %.cpp $(objects) $(headers)
	$(CXXCMD) $< $(objects) -o $@

data.zip:
	wget https://cs.famaf.unc.edu.ar/~nicolasw/data.zip

data: data.zip
	unzip data.zip

clean:
	rm -f $(objects) $(mains)

.PHONY: all clean
